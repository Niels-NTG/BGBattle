(function(){"use strict";angular.module("9095App",["ngRoute","ngTouch"]).config(["$routeProvider","$locationProvider",function(a,b){return a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/:load_id",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]).run(function(){return null!=window.screen.lockOrientation?window.screen.lockOrientation("landscape"):void 0})}).call(this),function(){"use strict";angular.module("9095App").controller("MainCtrl",["$scope","setup","$routeParams","toArrayFilter",function(a,b,c,d){var e;return null!=c.load_id&&b.loadPresets(c.load_id),b.loadSounds().then(function(){return a.controls=d(b.getSounds())}),e=function(){return null!==navigator.userAgent.match(/webkit/i)}}]),angular.module("9095App").filter("toArray",function(){return function(a){var b;return null!=a?b=Object.keys(a).map(function(b){var c;return c=a[b],{id:b,data:c}}).sort(function(a,b){return a.data.position-b.data.position}):void 0}})}.call(this),function(){"use strict";angular.module("9095App").directive("controlPanel",["sequencer","utils","toArrayFilter",function(a,b,c){return{templateUrl:"views/directives/control-panel.html",restrict:"E",replace:!0,scope:!0,link:function(d,e,f){return b.isSmallScreen()?d.label=d.control.id.split("_").map(function(a){return a[0]}).join(""):d.label=d.control.id.split("_").join(" "),d.label=d.label.toUpperCase(),d.knobs=c(d.control.data.knobs),d.isSelectedInstrument=function(){return a.getSelectedInstrument()===d.control.id},d.selectInstrument=function(b){return a.setSelectedInstrument(d.control.id),d.$root.$broadcast("pattern-select")}}}}])}.call(this),function(){"use strict";angular.module("9095App").directive("knob",["$window","$document","setup",function(a,b,c){return{templateUrl:"views/directives/knob.html",restrict:"E",replace:!0,scope:!0,link:function(d,e,f){var g,h,i,j,k,l,m,n,o,p,q;return d.sound_name=d.control.id,d.value=c.getKnobValue(d.sound_name,d.knob.id),d.label=d.knob.id.toUpperCase(),"accent"===d.sound_name&&(d.label=" "),p=0,q=0,m={radius:0,centerX:0,centerY:0},o=function(){var a;return a=e.find(".knob"),m.radius=a.width()/2-2,m.centerX=a.offset().left+m.radius,m.centerY=a.offset().top+m.radius},o(),angular.element(a).bind("resize",function(){return o()}),e.find(".dot").css({top:3,left:17}),d.setValue=function(){return c.setKnobValue(d.sound_name,d.knob.id,d.value)},g=function(a){var b;return b=a/4*(2*Math.PI),b<Math.PI&&(b=-1*b),b>Math.PI&&(b=2*Math.PI-b),b},h=function(a){var b;return b=a*(180/Math.PI),0>b?b=Math.abs(Math.floor(b)):b>=0&&(b=Math.floor(180+Math.abs(b-180))),b=b/360*4},i=function(a,b){return Math.atan2(a[0]-b[0],a[1]-b[1])},n=function(a,b){var c;return c={top:m.radius+Math.cos(a)*m.radius,left:m.radius+Math.sin(a)*m.radius},e.find(".dot").css(c)},n(g(d.value),m.radius),d.$on("pattern-select",function(a,b){return d.value=c.getKnobValue(d.sound_name,d.knob.id),n(g(d.value),m.radius)}),document.onmouseup=function(a){return document.onmousemove=null},j=e.find(".knob"),j.bind("mousedown",function(a){return document.onmousemove=l}),j.bind("touchstart",function(a){return a.preventDefault(),j.addClass("knob-zoom"),o(),b.bind("touchmove",l),b.bind("touchend",k)}),k=function(a){var c;return j.removeClass("knob-zoom"),o(),c=i([p,q],[m.centerX,m.centerY]),n(c,m.radius),b.unbind("touchmove"),b.unbind("touchend")},l=function(a){var b;return a.preventDefault(),p=a.pageX,q=a.pageY+m.radius,null!=a.originalEvent&&null!=a.originalEvent.targetTouches&&null!=a.originalEvent.targetTouches[0]&&(p=a.originalEvent.targetTouches[0].pageX,q=a.originalEvent.targetTouches[0].pageY),0!==p&&0!==q?(b=i([p,q],[m.centerX,m.centerY]),n(b,m.radius),d.value=h(b),d.setValue(),d.$apply()):void 0}}}}])}.call(this),function(){"use strict";angular.module("9095App").service("setup",["$http","$q","$timeout","$location","$rootScope","presetStorage","notifications",function(a,b,c,d,e,f,g){var h,i,j,k,l,m,n;return window.AudioContext=window.AudioContext||window.webkitAudioContext,h=new AudioContext,n=b.defer(),j=[],m=!1,l=f.getEmpty(),i=h.createGain(),i.gain.value=l.master_volume,i.connect(h.destination),this.getMasterVolume=function(){return l.master_volume},this.setMasterVolume=function(a){return l.master_volume=a,i.gain.value=l.master_volume,m=!0},this.getSoundId=function(a){return l.sounds.filter(function(b){return b.id===a})[0]||null},this.getKnobValue=function(a,b){return l.sounds[a].knobs[b]},this.loadPresets=function(a){var b=this;return f.load(a).then(function(a){return b.setPresets(a),e.$apply(function(){return e.$broadcast("pattern-select",a),e.$broadcast("tempo-select",a.tempo),b.setMasterVolume(a.master_volume),g.hide()})})["catch"](function(a){return e.$apply(function(){return g.hide(),d.url("/")})})},this.savePresets=function(){var a,b;return b=d.url().slice(1),a={message:"Saving..."},g.display(a),new Promise(function(c,h){return f.save(l,b).then(function(a){var b;return b="/"+a,e.$apply(function(){return d.url(b),g.hide(),c(!0)})})["catch"](function(b){return a={message:b},g.display(a),h(!1)}),m=!1})},this.clearPresets=function(){return this.setPresets(f.getEmpty())},this.setPresets=function(a){return Object.keys(l.sounds).forEach(function(b){return a.sounds[b].buffer=l.sounds[b].buffer}),l=a,m=!1},this.getSounds=function(){return l.sounds},this.getTempo=function(){return l.tempo},this.setTempo=function(a){return l.tempo=a,m=!0},this.getAudioContext=function(){return h},this.ready=function(){return n.promise},this.loadSounds=function(){var b;return b=0,Object.keys(l.sounds).forEach(function(c){return null!=l.sounds[c]&&null!=l.sounds[c].buffer?a.get("sounds/"+c+".wav",{responseType:"arraybuffer"}).success(function(a){return h.decodeAudioData(a,function(a){return l.sounds[c].buffer=a}),11===++b?n.resolve():void 0},function(a){throw n.reject(),new Error(a)}):void 0}),n.promise},this.setKnobValue=function(a,b,c){return l.sounds[a].knobs[b]=c,m=!0},this.setStepValue=function(a,b,c,d,e){return l.sounds[a].tracks[b][c][d]=e,m=!0},this.changed=function(){return m},this.playSound=function(a,b,c){return k(a,l.sounds[a],b,c)},k=function(a,b,c,d){var e,f,g,k,m,n,o,p;return n=h.createBufferSource(),n.buffer=b.buffer,o=h.createGain(),g=1,f=1e3,e=l.sounds.accent.knobs.value/4,c>1&&(c+=e),"cl_hi_hat"===a&&j.length>0&&(k=j.pop(),null!=k&&(k.stop(d),j=[])),m=Object.keys(b.knobs),m.indexOf("tune")>-1&&(p=b.knobs.tune,n.playbackRate.value=Math.max(p/2,.1)),m.indexOf("level")>-1&&(p=b.knobs.level,g=p,g*=c,o.gain.value=g),m.indexOf("decay")>-1&&(p=b.knobs.decay,f=p/4,o.gain.setValueAtTime(g,h.currentTime),o.gain.linearRampToValueAtTime(0,h.currentTime+f)),"o_hi_hat"===a&&j.push(n),n.connect(o),o.connect(i),n.start(d)},this}])}.call(this),function(){"use strict";angular.module("9095App").directive("sequencer",["$rootScope","sequencer",function(a,b){return{templateUrl:"views/directives/sequencer.html",restrict:"E",replace:!0,link:function(a,c,d){return a.steps=b.getSelectedPattern(),a.$on("pattern-select",function(c,d){return a.steps=b.getSelectedPattern()}),a.$on("step-click",function(a,c){return b.setStep(c.step,c.on)})}}}])}.call(this),function(){"use strict";angular.module("9095App").directive("masterVolume",["$window","$document","setup",function(a,b,c){return{templateUrl:"views/directives/master-volume.html",restrict:"E",replace:!0,link:function(d,e,f){var g,h,i,j,k;return d.volume=c.getMasterVolume(),j={},k=function(){var a;return a=e.find(".knob"),j.radius=a.width()/2-2,j.centerX=a.offset().left+j.radius,j.centerY=a.offset().top+j.radius},k(),angular.element(a).bind("resize",function(){return k()}),e.find(".dot").css({top:10,left:13}),g=function(a){var b;return b=a*(180/Math.PI),0>b?b=Math.abs(Math.floor(b)):b>=0&&(b=Math.floor(180+Math.abs(b-180))),b=Math.floor(b/30)/10},document.onmouseup=function(a){return document.onmousemove=null},h=e.find(".knob"),h.bind("mousedown",function(a){return document.onmousemove=i}),h.bind("touchstart",function(a){return a.preventDefault(),b.bind("touchmove",i),b.bind("touchend",function(){return b.unbind("touchmove")})}),i=function(a){var b,f,h,i;return a.preventDefault(),h=a.pageX,i=a.pageY-180,null!=a.originalEvent&&null!=a.originalEvent.targetTouches&&null!=a.originalEvent.targetTouches[0]&&(h=a.originalEvent.targetTouches[0].pageX,i=a.originalEvent.targetTouches[0].pageY-180),0!==h&&0!==i?(b=Math.atan2(h-j.centerX,i-j.centerY),f={top:j.radius+Math.cos(b)*j.radius,left:j.radius+Math.sin(b)*j.radius},d.volume=g(b),d.$apply(function(){return c.setMasterVolume(d.volume)}),e.find(".dot").css(f)):void 0}}}}])}.call(this),function(){"use strict";angular.module("9095App").directive("trackSelect",["sequencer","keyboard",function(a,b){return{templateUrl:"views/directives/track-select.html",restrict:"E",replace:!0,link:function(c,d,e){return c.tracks=[0,1,2,3],c.patterns=[0,1,2,3],c.selected={orig_track:0,track:0,pattern:0},c.setTrack=function(a){return c.selected.track=a},c.setPattern=function(b){return c.selected.orig_track=c.selected.track,c.selected.pattern=b,a.setSelectedPattern(c.selected.orig_track,c.selected.pattern),c.$root.$broadcast("pattern-select")},b.assign(49,function(){return c.setTrack(0),c.$apply()}),b.assign(50,function(){return c.setTrack(1),c.$apply()}),b.assign(51,function(){return c.setTrack(2),c.$apply()}),b.assign(52,function(){return c.setTrack(3),c.$apply()}),b.assign(113,function(){return c.setPattern(0),c.$apply()}),b.assign(119,function(){return c.setPattern(1),c.$apply()}),b.assign(101,function(){return c.setPattern(2),c.$apply()}),b.assign(114,function(){return c.setPattern(3),c.$apply()})}}}])}.call(this),function(){"use strict";angular.module("9095App").directive("tempo",["$window","$document","sequencer",function(a,b,c){return{templateUrl:"views/directives/tempo.html",restrict:"E",replace:!0,link:function(d,e,f){var g,h,i,j,k,l,m,n;return d.$on("tempo-select",function(a,b){return c.setTempo(b),d.settings.tempo=c.getTempo()}),d.settings={tempo:c.getTempo()},m={},n=function(){var a;return a=e.find(".knob"),m.radius=a.width()/2-2,m.centerX=a.offset().left+m.radius,m.centerY=a.offset().top+m.radius},n(),angular.element(a).bind("resize",function(){return n()}),e.find(".dot").css({top:10,left:13}),h=function(a){var b;return b=a*(180/Math.PI),0>b?b=Math.abs(Math.floor(b)):b>=0&&(b=Math.floor(180+Math.abs(b-180))),b=Math.floor(b)},document.onmouseup=function(a){return document.onmousemove=null},i=e.find(".knob"),i.bind("mousedown",function(a){return document.onmousemove=l}),i.bind("touchstart",function(a){return a.preventDefault(),b.bind("touchmove",l),b.bind("touchend",function(){return b.unbind("touchmove")})}),l=function(a){var b,f,g,i;return a.preventDefault(),g=a.pageX,i=a.pageY-180,null!=a.originalEvent&&null!=a.originalEvent.targetTouches&&null!=a.originalEvent.targetTouches[0]&&(g=a.originalEvent.targetTouches[0].pageX,i=a.originalEvent.targetTouches[0].pageY-180),0!==g&&0!==i?(b=Math.atan2(g-m.centerX,i-m.centerY),f={top:m.radius+Math.cos(b)*m.radius,left:m.radius+Math.sin(b)*m.radius},d.settings.tempo=h(b),d.$apply(function(){return c.setTempo(d.settings.tempo)}),e.find(".dot").css(f)):void 0},k=(new Date).getTime(),j=[],g=function(){return Math.floor(j.reduce(function(a,b){return a+b})/j.length)},d.countBPM=function(){var a;return a=(new Date).getTime(),j.push(Math.floor(6e4/(a-k))),j.length>5&&(j=j.slice(1)),k=a,d.settings.tempo=g(),c.setTempo(d.settings.tempo)}}}}])}.call(this),function(){"use strict";angular.module("9095App").directive("startStop",["$window","sequencer","keyboard",function(a,b,c){return{templateUrl:"views/directives/start-stop.html",restrict:"E",replace:!0,link:function(a,d,e){return a.playing=!1,a.start=function(){return b.startPlay(!0),a.playing=!0},a.restart=function(){return b.restart()},a.stop=function(){return b.stopPlay(),a.playing=!1},a.toggle=function(){return a.playing?a.stop():a.playing?void 0:a.start()},c.assign(32,function(){return a.playing?a.stop():a.start(),a.$apply()})}}}])}.call(this),function(){"use strict";angular.module("9095App").directive("step",["sequencer",function(a){return{templateUrl:"views/directives/step.html",replace:!0,scope:{velocity:"="},restrict:"E",link:function(b,c,d){var e;return e=d.sid,b.step_index=parseInt(e)+1,b.flash=!1,b.toggleOn=function(){return++b.velocity>2&&(b.velocity=0),a.setStep(e,b.velocity)},b.$on("tick_"+e,function(a,c){return b.flash=!0}),0!==parseInt(e)?b.$on("tick_0",function(a,c){return b.flash=!1}):b.$on("tick_15",function(a,c){return b.flash=!1})}}}])}.call(this),function(){"use strict";angular.module("9095App").directive("toolbar",["setup","sequencer",function(a,b){return{restrict:"E",templateUrl:"views/directives/toolbar.html",link:function(b,c,d){return b.save=function(){return a.savePresets()},b.presetsChanged=function(){return a.changed()}}}}])}.call(this),function(){"use strict";angular.module("9095App").directive("notifications",["$timeout","$location","notifications",function(a,b,c){return{templateUrl:"views/directives/notifications.html",restrict:"E",replace:!0,link:function(c,d,e){var f,g,h;return h=b.url().slice(1).length>0,f=function(a,b){return c.notification.message=b.message,d.show(),c.notification.visible=!0},g=function(){return c.notification.visible=!1,a(function(){return d.hide()},300)},c.notification={visible:h,message:"Loading..."},h||g(),c.$on("show-notification",f),c.$on("hide-notification",g)}}}])}.call(this),function(){"use strict";angular.module("9095App").service("sequencer",["$rootScope","$timeout","setup",function(a,b,c){var d,e,f,g,h,i,j,k,l,m;return m=null,j=c.getTempo(),this.getTempo=function(){return j},this.setTempo=function(a){return j=a,c.setTempo(j)},i={track:0,pattern:0,playing_track:0,playing_pattern:0,instrument:Object.keys(c.getSounds())[0]},l=0,e=0,g=.1,d=25,f=[],k=function(b){var d,f,g,h,k,m,n;a.$broadcast("tick_"+l,{}),d=1,g=c.getSounds();for(n in g)m=g[n],h=m.tracks[i.playing_track][i.playing_pattern],h[l]>0&&"accent"!==n&&(k=h[l]+g.accent.tracks[i.playing_track][i.playing_pattern][l],c.playSound(n,k,b));return f=60/j,e+=.25*f,++l>15?(l=0,i.playing_track=i.track,i.playing_pattern=i.pattern):void 0},h=function(){for(;e<c.getAudioContext().currentTime+g;)k(e);return m=b(h,d)},this.getSelectedPattern=function(){return c.getSounds()[i.instrument].tracks[i.track][i.pattern]},this.setSelectedPattern=function(a,b){var d,e,f,g;i.track=parseInt(a),i.pattern=parseInt(b),d=c.getSounds(),f=[];for(g in d)e=d[g],null==e.tracks[i.track]?f.push(e.tracks[i.track]=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]):e.tracks[i.track][i.pattern]?f.push(void 0):f.push(e.tracks[i.track][i.pattern]=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);return f},this.getSelectedInstrument=function(){return i.instrument},this.setSelectedInstrument=function(a){return i.instrument=a},this.setStep=function(a,b){return c.setStepValue(i.instrument,i.track,i.pattern,a,b)},this.restart=function(){return null!=m?(b.cancel(m),l=0,e=c.getAudioContext().currentTime,h()):void 0},this.stopPlay=function(){return b.cancel(m),m=null},this.startPlay=function(a){return a&&(l=0),e=c.getAudioContext().currentTime,h()},this}])}.call(this),function(){"use strict";angular.module("9095App").factory("utils",function(){return{isSmallScreen:function(){return window.innerWidth<768}}})}.call(this),function(){"use strict";angular.module("9095App").factory("presetStorage",["$location",function(a){var b,c,d;return b="TODO: set this if you want to use firebase for saving/loading",d={tempo:120,master_volume:1,sounds:{accent:{position:0,knobs:{value:2},tracks:[[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]]},bass_drum:{position:1,buffer:"notset",knobs:{tune:2,level:1,decay:2},tracks:[[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]]},snare_drum:{position:2,buffer:"notset",knobs:{tune:2,level:1,decay:2},tracks:[[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]]},low_tom:{position:3,buffer:"notset",knobs:{tune:2,level:1,decay:2},tracks:[[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]]},mid_tom:{position:4,buffer:"notset",knobs:{tune:2,level:1,decay:2},tracks:[[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]]},hi_tom:{position:5,buffer:"notset",knobs:{tune:2,level:1,decay:2},tracks:[[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]]},rim_shot:{position:6,buffer:"notset",knobs:{level:1},tracks:[[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]]},hand_clap:{position:7,buffer:"notset",knobs:{level:1},tracks:[[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]]},cl_hi_hat:{position:8,buffer:"notset",knobs:{level:1,decay:2},tracks:[[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]]},o_hi_hat:{position:9,buffer:"notset",knobs:{level:1,decay:2},tracks:[[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]]},crash:{position:10,buffer:"notset",knobs:{level:1,tune:2},tracks:[[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]]},ride:{position:11,buffer:"notset",knobs:{level:1,tune:2},tracks:[[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]]}}},c=function(a){var b;return b=new Firebase(a)},this.save=function(a,d){var e;return e=$.extend(!0,{},a),Object.keys(e.sounds).forEach(function(a){return e.sounds[a].buffer?e.sounds[a].buffer="notset":delete e.sounds[a].buffer}),new Promise(function(a,f){var g,h,i;return d.length>0?(h=""+b+"/tracks/"+d,g=c(h),g.update(e).then(function(b){return a(d)})["catch"](function(a){return f(a)})):(g=c(b),i=g.child("tracks"),i.push(e).then(function(b){var c;return c=b.key(),c?a(c):f(c)})["catch"](function(a){return f(a)}))})},this.load=function(a){var e,f;return f=""+b+"/tracks/"+a,e=c(f),new Promise(function(b,c){return e.once("value",function(e){return d=e.val(),d?b(d):c("ID "+a+" not found")})})},this.getEmpty=function(){return $.extend(!0,{},d)},this}])}.call(this),function(){"use strict";angular.module("9095App").factory("keyboard",function(){var a,b;return a={},b=function(b){return null!=a[b]?a[b]():void 0},this.assign=function(b,c){return a[b]=c},$(document).on("keypress",function(a){return b(a.charCode)}),this})}.call(this),function(){"use strict";angular.module("9095App").factory("notifications",["$rootScope",function(a){return this.display=function(b){return a.$broadcast("show-notification",b)},this.hide=function(){return a.$broadcast("hide-notification")},this}])}.call(this);